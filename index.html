<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Box Truck Inspection Report</title>
    <style>
        .hidden {
            display: none;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <h1>Box Truck Inspection Report</h1>
    <form id="inspection-form">
        <label for="inspection-datetime">Date and Time of Inspection:</label>
        <input type="datetime-local" id="inspection-datetime" name="inspection-datetime" required>
        
        <fieldset>
            <legend>Damage Status:</legend>
            <input type="radio" id="no-damage" name="damage-status" value="no-damage" required>
            <label for="no-damage">No Damage</label>
            <input type="radio" id="damaged" name="damage-status" value="damaged">
            <label for="damaged">Damaged</label>
        </fieldset>

        <div id="damage-details" class="hidden">
            <label for="damage-location">Location of Damage:</label>
            <input type="text" id="damage-location" name="damage-location">
            
            <label for="damage-description">Description of Damage:</label>
            <input type="text" id="damage-description" name="damage-description">
            
            <label for="damage-severity">Severity of Damage:</label>
            <select id="damage-severity" name="damage-severity">
                <option value="minor">Minor</option>
                <option value="moderate">Moderate</option>
                <option value="severe">Severe</option>
            </select>
        </div>
        
        <button type="submit">Add to Report</button>
    </form>
    
    <h2>Damage Reports</h2>
    <div id="damage-list"></div>
    
    <button id="export-pdf-btn">Export to PDF</button>
    <button id="share-email-btn">Share via Email</button>
    
    <div id="email-modal" class="hidden">
        <form id="email-form">
            <label for="recipient-email">Recipient Email:</label>
            <input type="email" id="recipient-email" name="recipient-email" required>
            
            <label for="email-subject">Subject:</label>
            <input type="text" id="email-subject" name="email-subject" required>
            
            <label for="email-body">Body:</label>
            <textarea id="email-body" name="email-body" required></textarea>
            
            <button type="submit">Send Email</button>
            <button type="button" id="close-modal">Close</button>
        </form>
    </div>

    <script>
        const { jsPDF } = window.jspdf;

        const form = document.getElementById('inspection-form');
        const damageList = document.getElementById('damage-list');
        const exportPdfBtn = document.getElementById('export-pdf-btn');
        const shareEmailBtn = document.getElementById('share-email-btn');
        const emailModal = document.getElementById('email-modal');
        const emailForm = document.getElementById('email-form');
        const closeModal = document.getElementById('close-modal');
        const damageDetails = document.getElementById('damage-details');
        const damageStatusRadios = document.querySelectorAll('input[name="damage-status"]');

        function addDamageReport(report) {
            const damageItem = document.createElement('div');
            damageItem.className = 'damage-item';
            damageItem.innerHTML = `
                <h3>${report.datetime}</h3>
                <p><strong>Status:</strong> ${report.status}</p>
                <p><strong>Location:</strong> ${report.location}</p>
                <p><strong>Description:</strong> ${report.description}</p>
                <p><strong>Severity:</strong> ${report.severity}</p>
            `;
            damageList.appendChild(damageItem);
        }

        function getDamageReports() {
            const reports = [];
            document.querySelectorAll('.damage-item').forEach(item => {
                reports.push({
                    datetime: item.querySelector('h3').innerText,
                    status: item.querySelector('p:nth-child(2)').innerText.split(': ')[1],
                    location: item.querySelector('p:nth-child(3)').innerText.split(': ')[1],
                    description: item.querySelector('p:nth-child(4)').innerText.split(': ')[1],
                    severity: item.querySelector('p:nth-child(5)').innerText.split(': ')[1],
                });
            });
            return reports;
        }

        function exportToPdf() {
            const doc = new jsPDF();

            doc.setFontSize(18);
            doc.text('Box Truck Inspection Report', 20, 20);

            const reports = getDamageReports();
            let yOffset = 30;

            reports.forEach(report => {
                doc.setFontSize(12);
                doc.text(`Inspection Report at ${report.datetime}`, 20, yOffset);
                yOffset += 10;
                doc.text(`Status: ${report.status}`, 20, yOffset);
                yOffset += 10;
                if (report.status === 'damaged') {
                    doc.text(`Location: ${report.location}`, 20, yOffset);
                    yOffset += 10;
                    doc.text(`Description: ${report.description}`, 20, yOffset);
                    yOffset += 10;
                    doc.text(`Severity: ${report.severity}`, 20, yOffset);
                    yOffset += 10;
                }
                yOffset += 10;
            });

            doc.save('inspection-report.pdf');
        }

        form.addEventListener('submit', function (e) {
            e.preventDefault();
            const datetime = document.getElementById('inspection-datetime').value;
            const damageStatus = document.querySelector('input[name="damage-status"]:checked').value;
            const damageLocation = document.getElementById('damage-location').value;
            const damageDescription = document.getElementById('damage-description').value;
            const damageSeverity = document.getElementById('damage-severity').value;

            const report = {
                datetime,
                status: damageStatus,
                location: damageStatus === 'damaged' ? damageLocation : '',
                description: damageStatus === 'damaged' ? damageDescription : '',
                severity: damageStatus === 'damaged' ? damageSeverity : ''
            };

            addDamageReport(report);
            form.reset();
            document.getElementById('inspection-datetime').value = new Date().toISOString().slice(0, 16);
            damageDetails.classList.add('hidden');
        });

        exportPdfBtn.addEventListener('click', exportToPdf);

        shareEmailBtn.addEventListener('click', function () {
            emailModal.style.display = 'block';
        });

        closeModal.addEventListener('click', function () {
            emailModal.style.display = 'none';
        });

        window.addEventListener('click', function (event) {
            if (event.target === emailModal) {
                emailModal.style.display = 'none';
            }
        });

        emailForm.addEventListener('submit', function (e) {
            e.preventDefault();
            const recipientEmail = document.getElementById('recipient-email').value;
            const subject = document.getElementById('email-subject').value;
            const body = document.getElementById('email-body').value;

            // Placeholder for email functionality
            // Implement email sending logic here

            emailModal.style.display = 'none';
        });

        damageStatusRadios.forEach(radio => {
            radio.addEventListener('change', function () {
                if (this.value === 'no-damage') {
                    damageDetails.classList.add('hidden');
                } else {
                    damageDetails.classList.remove('hidden');
                }
            });
        });

        // Set initial datetime
        document.getElementById('inspection-datetime').value = new Date().toISOString().slice(0, 16);

        // Set initial damage details visibility based on the selected radio button
        const initialDamageStatus = document.querySelector('input[name="damage-status"]:checked');
        if (initialDamageStatus && initialDamageStatus.value === 'damaged') {
            damageDetails.classList.remove('hidden');
        } else {
            damageDetails.classList.add('hidden');
        }
    </script>
</body>
</html>
